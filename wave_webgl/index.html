<!DOCTYPE html>
<html  lang="en-US">
<head> 
    <meta charset="UTF-8" />
    <meta name="viewport" content="height=device-height,width=device-width" />
    <meta name="viewport" content="initial-scale=1.0" />
    <meta name="HandheldFriendly" content="true"/>
    <title>ultrasimple - JouSuu</title>

    <script id="wave-vs" type="vertex-shader">
    attribute vec3 v_pos;
    attribute vec2 a_texCoord_input;
    varying vec2 v_texCoord_input;
    attribute vec2 a_texCoord_prev;
    varying vec2 v_texCoord_prev;
    attribute vec2 a_texCoord_prevprev;
    varying vec2 v_texCoord_prevprev;
    void main(void)
    {
        gl_Position = vec4(v_pos,1.0);
        v_texCoord_input = a_texCoord_input;
        v_texCoord_prev = a_texCoord_prev;
        v_texCoord_prevprev = a_texCoord_prevprev;
    }
    </script>

    <script id="wave-fs" type="fragment-shader">
    precision mediump float;
    uniform sampler2D texture_input;
    uniform sampler2D texture_prev;
    uniform sampler2D texture_prevprev;
    varying vec2 v_texCoord_input;
    varying vec2 v_texCoord_prev;
    varying vec2 v_texCoord_prevprev;
    uniform vec2 u_resolution;
    void main(void)
    {
        // wave equation
        float c = 0.45;
        vec2 i = v_texCoord_input;
        float _Stride = 1.0 / u_resolution.x;

        float h = texture2D(texture_prev, i).r * 2.0 - 1.0;
        float h_x_plus_1 = texture2D(texture_prev, i + vec2(_Stride,0.0)).r * 2.0 - 1.0;
        float h_x_minus_1 = texture2D(texture_prev, i + vec2(-_Stride, 0.0)).r * 2.0 - 1.0;
        float h_y_plus_1 = texture2D(texture_prev, i + vec2(0.0, _Stride)).r * 2.0 - 1.0;
        float h_y_minus_1 = texture2D(texture_prev, i + vec2(0.0, -_Stride)).r * 2.0 - 1.0;
        float h_t_minus_1 = texture2D(texture_prevprev, i).r * 2.0 - 1.0;

        //h(t+1) = c{h(x+1) + h(x-1) + h(y+1) + h(h-1) - 4h} - h(t-1) + 2h
        float h_t_plus_1 =c * (h_x_plus_1 + h_x_minus_1 + h_y_plus_1+ h_y_minus_1 - 4.0*h) - h_t_minus_1 + 2.0 *h;

        h_t_plus_1 *= 0.998;
        //h_t_plus_1 *= 1.0;
        //h_t_plus_1 = h;

        h_t_plus_1 += texture2D(texture_input, v_texCoord_input).r*1.5;

        gl_FragColor = vec4(h_t_plus_1,h_t_plus_1,h_t_plus_1,1);
        //gl_FragColor = vec4(-texture2D(texture, v_texCoord).x,0,0,1);
        //gl_FragColor = texture2D(texture_input, v_texCoord_input);
    }
    </script>





    <script id="simple-vs" type="vertex-shader">
    attribute vec3 v_pos;
    attribute vec2 a_texCoord;
    varying vec2 v_texCoord;
    void main(void)
    {
        gl_Position = vec4(v_pos,1.0);
        v_texCoord = a_texCoord;
    }
    </script>

    <script id="simple-fs" type="fragment-shader">
    precision mediump float;
    uniform sampler2D texture;
    varying vec2 v_texCoord;
    void main(void)
    {
        gl_FragColor = texture2D(texture, v_texCoord);
    }
    </script>





    <script id="input-vs" type="vertex-shader">
    attribute vec3 v_pos;
    void main(void)
    {
        gl_Position = vec4(v_pos,1.0);
    }
    </script>
    <script id="input-fs" type="fragment-shader">
    precision mediump float;
    uniform vec3 u_color;
    uniform vec2 u_mousePos;
    uniform vec2 u_resolution;
    uniform bool u_click;
    void main(void)
    {
        vec2 pos = (gl_FragCoord.xy/u_resolution.xy);
        vec2 mouse = (u_mousePos.xy/u_resolution.xy);

        float col = 0.1;
        if(u_click)
        {
            vec2 diff = vec2(mouse.x-pos.x,1.0-mouse.y-pos.y);
            col = 1.0-length(diff);
            col = clamp(pow(col, 10.0),0.0,1.0);
        }
        /*
        else
        {
            vec2 diff = vec2(0.8-pos.x,1.0-0.2-pos.y);
            col = 1.0-length(diff);
            col = clamp(pow(col, 10.0),0.1,1.0);
        }
        */
        gl_FragColor = vec4(col,col,col,1);
    }
    </script>




    <script src="../thirdlib/gl-matrix.js" type="text/javascript"></script>
    <script src="sketch.js" type="text/javascript"></script>
</head>
<body style="background: #000; margin:3px;">
  <canvas id="glcanvas"></canvas>
  </br><font color="red">x </font><font color="green">y </font><font color="blue">z</font>

</body>
</html>